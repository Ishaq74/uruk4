# üéØ Plan d'Action - Salut Annecy

> **Bas√© sur** : [CRITIQUE_ET_PRECONISATION.md](./CRITIQUE_ET_PRECONISATION.md)  
> **Cr√©√© le** : 2024  
> **Statut** : üìã En cours

Ce document transforme les critiques et recommandations en un plan d'action concret et mesurable.

---

## üìä Vue d'Ensemble

### √âtat Actuel vs Objectif

| M√©trique | Actuel | Objectif | Progr√®s |
|----------|--------|----------|---------|
| Couverture tests | 0% | 60% | ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± 0% |
| Endpoints fonctionnels | 13% | 100% | ‚ñ∞‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± 13% |
| Documentation √† jour | 30% | 90% | ‚ñ∞‚ñ∞‚ñ∞‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± 30% |
| Issues de s√©curit√© | 5 critiques | 0 | ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± 0% |
| √âtat fonctionnel | 40% | 95% | ‚ñ∞‚ñ∞‚ñ∞‚ñ∞‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± 40% |

---

## üî¥ PHASE 1 : Corrections Critiques (Semaines 1-3)

### Sprint 1 : S√©curit√© et Documentation (Semaine 1)

#### 1.1 S√©curisation Imm√©diate ‚ö†Ô∏è URGENT

**T√¢ches** :

- [ ] **Validation des secrets** (2h)
  - [ ] Cr√©er `scripts/validate-env.ts`
  - [ ] Ajouter validation au d√©marrage
  - [ ] Interdire les secrets par d√©faut en production
  - [ ] Mettre √† jour documentation .env.example
  
  ```typescript
  // scripts/validate-env.ts
  if (process.env.NODE_ENV === 'production') {
    if (process.env.BETTER_AUTH_SECRET === 'your-super-secret-key-here-change-this-in-production') {
      throw new Error('‚ùå BETTER_AUTH_SECRET must be changed in production!');
    }
    if (!process.env.DATABASE_URL) {
      throw new Error('‚ùå DATABASE_URL is required in production');
    }
  }
  ```

- [ ] **Rate Limiting** (3h)
  - [ ] `npm install express-rate-limit`
  - [ ] Configurer limiter global (100 req/15min)
  - [ ] Configurer limiter auth (5 req/15min)
  - [ ] Ajouter tests de rate limiting
  
  ```typescript
  // server.ts
  import rateLimit from 'express-rate-limit';
  
  const generalLimiter = rateLimit({
    windowMs: 15 * 60 * 1000,
    max: 100
  });
  
  const authLimiter = rateLimit({
    windowMs: 15 * 60 * 1000,
    max: 5
  });
  
  app.use('/api/', generalLimiter);
  app.use('/api/auth/', authLimiter);
  ```

- [ ] **D√©sactiver logs sensibles** (1h)
  - [ ] Cr√©er utilitaire `utils/logger.ts`
  - [ ] Remplacer tous les `console.log` sensibles
  - [ ] Ajouter niveau de log configurables (dev/prod)
  
  ```typescript
  // utils/logger.ts
  export const logger = {
    debug: (msg: string, data?: any) => {
      if (process.env.NODE_ENV === 'development') {
        console.log(msg, data);
      }
    },
    error: (msg: string, error?: any) => {
      console.error(msg, error);
    }
  };
  ```

- [ ] **CORS s√©curis√©** (1h)
  - [ ] Configurer CORS bas√© sur env
  - [ ] Lister domaines autoris√©s
  - [ ] Tester en dev et prod

**Livrable** : Application s√©curis√©e avec validation des secrets et rate limiting actifs.

---

#### 1.2 Documentation R√©elle (4h)

**T√¢ches** :

- [ ] **Cr√©er ARCHITECTURE.md** (2h)
  - [ ] D√©crire l'architecture R√âELLE
  - [ ] Diagramme des composants
  - [ ] Expliquer la dualit√© actuelle (mock vs DB)
  - [ ] Documenter les d√©pendances
  
- [ ] **Cr√©er API.md** (1h)
  - [ ] Lister tous les endpoints
  - [ ] Indiquer le statut (‚úÖ Fonctionnel / ‚ö†Ô∏è Mock / ‚ùå Non impl√©ment√©)
  - [ ] Exemples de requ√™tes/r√©ponses
  - [ ] Codes d'erreur
  
- [ ] **Corriger PRODUCTION_READY.md** (30min)
  - [ ] Retirer les mentions trompeuses
  - [ ] Clarifier ce qui est vraiment production-ready
  - [ ] Ajouter section "Known Limitations"
  
- [ ] **Cr√©er GETTING_STARTED.md** (30min)
  - [ ] Guide de setup simplifi√©
  - [ ] Pr√©requis clairement list√©s
  - [ ] √âtapes num√©rot√©es
  - [ ] Troubleshooting commun

**Livrable** : Documentation pr√©cise et compl√®te de l'√©tat actuel du projet.

---

#### 1.3 D√©cision Architecturale (2h)

**T√¢ches** :

- [ ] **Analyser les options** (1h)
  - [ ] Cr√©er tableau comparatif Option A vs Option B
  - [ ] Estimer effort pour chaque option
  - [ ] Identifier risques et b√©n√©fices
  
- [ ] **Cr√©er ARCHITECTURE_DECISION.md** (1h)
  - [ ] Documenter le choix
  - [ ] Justifier la d√©cision
  - [ ] Plan de migration
  - [ ] Timeline estim√©e

**Options** :

| Crit√®re | Option A: Full PostgreSQL | Option B: Full Mock |
|---------|---------------------------|---------------------|
| **Effort** | 6-8 semaines | 1-2 semaines |
| **Production-ready** | ‚úÖ Oui | ‚ùå Non (d√©mo seulement) |
| **Scalabilit√©** | ‚úÖ Excellente | ‚ùå Limit√©e |
| **Co√ªt serveur** | $$$ | $ |
| **Complexit√©** | Haute | Faible |
| **Recommandation** | ‚úÖ Pour app r√©elle | ‚ö†Ô∏è Pour prototype |

**Livrable** : D√©cision architecturale document√©e et valid√©e.

---

### Sprint 2 : Correction de l'Architecture (Semaines 2-3)

#### 2.1 Si Option A Choisie : Migration PostgreSQL

**T√¢ches** :

- [ ] **Cr√©er DataProvider avec Context API** (4h)
  - [ ] Cr√©er `contexts/DataContext.tsx`
  - [ ] Impl√©menter provider avec cache
  - [ ] Ajouter √©tats loading/error
  - [ ] Tests unitaires du provider
  
  ```typescript
  // contexts/DataContext.tsx
  interface DataContextType {
    places: Place[];
    events: Event[];
    isLoading: boolean;
    error: Error | null;
    refetch: () => Promise<void>;
  }
  
  export const DataProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
    // Impl√©mentation avec cache et API calls
  };
  ```

- [ ] **Migrer Places vers API** (6h)
  - [ ] V√©rifier endpoint `/api/places`
  - [ ] Impl√©menter pagination
  - [ ] Ajouter filtres
  - [ ] Tests d'int√©gration
  - [ ] Migrer composants Places

- [ ] **Migrer Events vers API** (4h)
  - [ ] V√©rifier endpoint `/api/events`
  - [ ] Impl√©menter filtres par date
  - [ ] Tests d'int√©gration
  - [ ] Migrer composants Events

- [ ] **Migrer Articles vers API** (3h)
- [ ] **Migrer Trails vers API** (3h)
- [ ] **Migrer Listings vers API** (4h)

**Livrable** : Application connect√©e √† PostgreSQL avec cache c√¥t√© client.

---

#### 2.2 Si Option B Choisie : Consolidation Mock

**T√¢ches** :

- [ ] **Supprimer infrastructure DB** (2h)
  - [ ] Supprimer `schema.ts`, `schema.sql`
  - [ ] Supprimer `seed.ts`, `db.ts`
  - [ ] Supprimer Drizzle config
  - [ ] Nettoyer `package.json`

- [ ] **Cr√©er MockDataService** (4h)
  - [ ] Centraliser toutes les donn√©es mock
  - [ ] Interface API-like
  - [ ] Simuler latence r√©seau
  - [ ] Tests unitaires

- [ ] **Documenter limitations** (1h)
  - [ ] Clarifier que c'est une d√©mo
  - [ ] Lister fonctionnalit√©s non disponibles
  - [ ] Guide pour migration future

**Livrable** : Application mock coh√©rente et bien document√©e.

---

## üü† PHASE 2 : Stabilisation (Semaines 4-7)

### Sprint 3 : Tests Essentiels (Semaine 4)

#### 3.1 Configuration des Tests

**T√¢ches** :

- [ ] **Installer framework de test** (1h)
  ```bash
  npm install -D vitest @testing-library/react @testing-library/jest-dom jsdom
  npm install -D @vitest/ui
  ```

- [ ] **Configurer Vitest** (1h)
  - [ ] Cr√©er `vitest.config.ts`
  - [ ] Setup DOM testing
  - [ ] Ajouter scripts de test √† package.json
  
  ```json
  {
    "scripts": {
      "test": "vitest",
      "test:ui": "vitest --ui",
      "test:coverage": "vitest --coverage"
    }
  }
  ```

- [ ] **Cr√©er structure de tests** (1h)
  ```
  tests/
  ‚îú‚îÄ‚îÄ unit/
  ‚îÇ   ‚îú‚îÄ‚îÄ components/
  ‚îÇ   ‚îú‚îÄ‚îÄ utils/
  ‚îÇ   ‚îî‚îÄ‚îÄ services/
  ‚îú‚îÄ‚îÄ integration/
  ‚îÇ   ‚îú‚îÄ‚îÄ api/
  ‚îÇ   ‚îî‚îÄ‚îÄ flows/
  ‚îî‚îÄ‚îÄ setup.ts
  ```

**Livrable** : Infrastructure de test configur√©e et fonctionnelle.

---

#### 3.2 Tests Critiques

**T√¢ches** :

- [ ] **Tests d'authentification** (4h)
  - [ ] `tests/integration/auth.test.ts`
  - [ ] Test login/logout
  - [ ] Test register
  - [ ] Test session persistence
  - [ ] Test role-based access

- [ ] **Tests des endpoints API** (6h)
  - [ ] `tests/integration/api/places.test.ts`
  - [ ] `tests/integration/api/events.test.ts`
  - [ ] Tests CRUD complets
  - [ ] Tests de validation
  - [ ] Tests d'erreurs

- [ ] **Tests des composants critiques** (4h)
  - [ ] HomePage
  - [ ] PlaceDetailPage
  - [ ] SearchPage
  - [ ] AdminDashboard

**Objectif** : **60% de couverture** sur les fonctionnalit√©s critiques.

**Livrable** : Suite de tests avec couverture ‚â• 60%.

---

### Sprint 4 : Gestion d'√âtat Moderne (Semaine 5)

#### 4.1 Migration vers Zustand

**T√¢ches** :

- [ ] **Installer Zustand** (15min)
  ```bash
  npm install zustand
  ```

- [ ] **Cr√©er stores de base** (6h)
  - [ ] `stores/authStore.ts`
  - [ ] `stores/placesStore.ts`
  - [ ] `stores/eventsStore.ts`
  - [ ] `stores/uiStore.ts` (modals, loading, etc.)

  ```typescript
  // stores/placesStore.ts
  import { create } from 'zustand';
  import { Place } from '../types';
  
  interface PlacesState {
    places: Place[];
    isLoading: boolean;
    error: Error | null;
    fetchPlaces: () => Promise<void>;
    addPlace: (place: Place) => void;
  }
  
  export const usePlacesStore = create<PlacesState>((set) => ({
    places: [],
    isLoading: false,
    error: null,
    fetchPlaces: async () => {
      set({ isLoading: true });
      try {
        const response = await fetch('/api/places');
        const places = await response.json();
        set({ places, isLoading: false });
      } catch (error) {
        set({ error: error as Error, isLoading: false });
      }
    },
    addPlace: (place) => set((state) => ({ 
      places: [...state.places, place] 
    }))
  }));
  ```

- [ ] **Migrer App.tsx** (4h)
  - [ ] Supprimer les useState
  - [ ] Utiliser les stores Zustand
  - [ ] Simplifier le code
  - [ ] Tests de non-r√©gression

**Livrable** : Application avec state management moderne et performant.

---

### Sprint 5 : Fallbacks et Robustesse (Semaine 6)

#### 5.1 Fallbacks Gemini API

**T√¢ches** :

- [ ] **Cr√©er recherche basique** (4h)
  - [ ] `services/basicSearch.ts`
  - [ ] Recherche par nom/description
  - [ ] Filtrage par cat√©gorie
  - [ ] Tri par pertinence

- [ ] **Impl√©menter fallback dans SearchPage** (2h)
  ```typescript
  const performSearch = async (query: string) => {
    if (!process.env.VITE_GEMINI_API_KEY) {
      setWarning('Recherche basique activ√©e. Pour la recherche AI, configurez VITE_GEMINI_API_KEY');
      return basicSearch(query, places, articles, trails);
    }
    // Recherche AI
  };
  ```

- [ ] **Am√©liorer messages d'erreur** (2h)
  - [ ] Messages contextuels
  - [ ] Suggestions d'action
  - [ ] Toast notifications

**Livrable** : Application fonctionnelle m√™me sans cl√© API Gemini.

---

#### 5.2 Gestion d'Erreurs Globale

**T√¢ches** :

- [ ] **Error Boundary React** (2h)
  - [ ] Cr√©er `components/ErrorBoundary.tsx`
  - [ ] Wrapper App.tsx
  - [ ] Page d'erreur friendly

- [ ] **Intercepteur d'erreurs API** (2h)
  - [ ] Cr√©er `utils/apiClient.ts`
  - [ ] Gestion centralis√©e des erreurs
  - [ ] Retry automatique
  - [ ] Logging

**Livrable** : Application r√©siliente avec gestion d'erreurs robuste.

---

### Sprint 6 : Consolidation Documentation (Semaine 7)

**T√¢ches** :

- [ ] **Archiver docs obsol√®tes** (1h)
  ```bash
  mkdir docs/archive
  mv SETUP_COMPLETE.md docs/archive/
  mv IMPLEMENTATION_SUMMARY.md docs/archive/
  # ... autres fichiers redondants
  ```

- [ ] **Mettre √† jour README.md** (2h)
  - [ ] Refl√©ter l'√©tat actuel
  - [ ] Liens vers docs pertinentes
  - [ ] Screenshots actualis√©s

- [ ] **Cr√©er CONTRIBUTING.md** (2h)
  - [ ] Guidelines de contribution
  - [ ] Process PR
  - [ ] Standards de code
  - [ ] Comment lancer les tests

- [ ] **Finaliser API.md** (2h)
  - [ ] Documenter tous les endpoints
  - [ ] Exemples cURL
  - [ ] Sch√©mas de r√©ponse

**Livrable** : Documentation compl√®te, coh√©rente et √† jour.

---

## üü° PHASE 3 : Optimisation (Semaines 8-10)

### Sprint 7 : Performance (Semaine 8)

**T√¢ches** :

- [ ] **Code Splitting** (4h)
  - [ ] React.lazy() sur routes
  - [ ] Suspense boundaries
  - [ ] Pr√©charger routes critiques

- [ ] **Pagination r√©elle** (6h)
  - [ ] Backend : limit/offset
  - [ ] Frontend : composant Pagination
  - [ ] Infinite scroll (optionnel)

- [ ] **Optimisation images** (4h)
  - [ ] Lazy loading images
  - [ ] Conversion WebP
  - [ ] Responsive images

**Livrable** : Application performante (Lighthouse > 85).

---

### Sprint 8 : Monitoring (Semaine 9)

**T√¢ches** :

- [ ] **Installer Sentry** (2h)
  ```bash
  npm install @sentry/react @sentry/node
  ```

- [ ] **Configurer error tracking** (2h)
  - [ ] Frontend monitoring
  - [ ] Backend monitoring
  - [ ] Source maps

- [ ] **Ajouter analytics basiques** (2h)
  - [ ] Page views
  - [ ] User actions
  - [ ] Performance metrics

**Livrable** : Monitoring actif en production.

---

### Sprint 9 : CI/CD (Semaine 10)

**T√¢ches** :

- [ ] **Cr√©er workflow GitHub Actions** (4h)
  - [ ] `.github/workflows/ci.yml`
  - [ ] Tests automatiques
  - [ ] Build verification
  - [ ] Linting

  ```yaml
  name: CI
  on: [push, pull_request]
  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-node@v3
          with:
            node-version: '18'
        - run: npm ci
        - run: npm test
        - run: npm run build
  ```

- [ ] **Setup d√©ploiement automatique** (4h)
  - [ ] Configuration Vercel/Netlify
  - [ ] Variables d'environnement
  - [ ] Preview deployments

**Livrable** : Pipeline CI/CD fonctionnel.

---

## üìã Checklist de Suivi

### S√©curit√© ‚úÖ

- [ ] Validation des secrets impl√©ment√©e
- [ ] Rate limiting configur√©
- [ ] Logs sensibles s√©curis√©s
- [ ] CORS correctement configur√©
- [ ] Validation d'input c√¥t√© serveur
- [ ] 0 issue de s√©curit√© critique

### Architecture ‚úÖ

- [ ] D√©cision architecturale prise et document√©e
- [ ] Migration vers architecture choisie compl√®te
- [ ] Dualit√© mock/DB r√©solue
- [ ] State management moderne en place

### Tests ‚úÖ

- [ ] Framework de test configur√©
- [ ] Tests d'authentification ‚â• 80%
- [ ] Tests API ‚â• 60%
- [ ] Tests composants critiques ‚â• 50%
- [ ] Couverture globale ‚â• 60%

### Documentation ‚úÖ

- [ ] ARCHITECTURE.md cr√©√©
- [ ] API.md cr√©√© et complet
- [ ] GETTING_STARTED.md cr√©√©
- [ ] PRODUCTION_READY.md corrig√©
- [ ] Docs obsol√®tes archiv√©es
- [ ] README.md √† jour

### Performance ‚úÖ

- [ ] Code splitting impl√©ment√©
- [ ] Pagination r√©elle
- [ ] Images optimis√©es
- [ ] Lighthouse score ‚â• 85

### Production ‚úÖ

- [ ] Monitoring actif (Sentry)
- [ ] CI/CD configur√©
- [ ] D√©ploiement automatique
- [ ] Documentation d√©ploiement compl√®te

---

## üéØ Jalons Cl√©s

| Jalon | Date Cible | Crit√®res de Succ√®s |
|-------|------------|-------------------|
| **Jalon 1 : S√©curit√©** | Semaine 1 | Toutes les issues de s√©curit√© r√©solues |
| **Jalon 2 : Architecture** | Semaine 3 | Architecture coh√©rente et document√©e |
| **Jalon 3 : Tests** | Semaine 4 | 60% de couverture atteinte |
| **Jalon 4 : State Management** | Semaine 5 | Migration Zustand compl√®te |
| **Jalon 5 : Documentation** | Semaine 7 | Documentation compl√®te et √† jour |
| **Jalon 6 : Performance** | Semaine 8 | Lighthouse > 85 |
| **Jalon 7 : Production Ready** | Semaine 10 | CI/CD + Monitoring actifs |

---

## üìû Points de D√©cision

### D√©cisions Requises (Semaine 1)

1. **Architecture** : Full PostgreSQL ou Full Mock ?
2. **Timeline** : 1 dev ou √©quipe ?
3. **Budget** : H√©bergement DB et services ?
4. **Priorit√©s** : Fonctionnalit√©s √† garder/supprimer ?

### D√©cisions Optionnelles (Semaine 4+)

1. State management : Zustand ou Redux Toolkit ?
2. Tests E2E : Playwright ou Cypress ?
3. H√©bergement : Vercel, Netlify, ou custom ?
4. Monitoring : Sentry ou alternative ?

---

## üöÄ Prochaines Actions Imm√©diates

### √Ä faire AUJOURD'HUI

1. ‚úÖ Lire ce plan d'action complet
2. ‚è≥ D√©cider de l'option architecturale (A ou B)
3. ‚è≥ Cr√©er branche `feature/security-fixes`
4. ‚è≥ Commencer Sprint 1 : S√©curisation

### √Ä faire CETTE SEMAINE

1. ‚è≥ Impl√©menter validation des secrets
2. ‚è≥ Ajouter rate limiting
3. ‚è≥ Cr√©er ARCHITECTURE.md
4. ‚è≥ Cr√©er API.md
5. ‚è≥ Finaliser d√©cision architecturale

---

## üìä Suivi de Progression

```
PHASE 1 : Corrections Critiques (0/3 sprints)
‚îú‚îÄ‚îÄ Sprint 1 : S√©curit√© et Documentation (0/15 t√¢ches)
‚îú‚îÄ‚îÄ Sprint 2 : Architecture (0/12 t√¢ches)
‚îî‚îÄ‚îÄ Sprint 3 : Stabilisation initiale (0/8 t√¢ches)

PHASE 2 : Stabilisation (0/4 sprints)
‚îú‚îÄ‚îÄ Sprint 4 : Tests (0/10 t√¢ches)
‚îú‚îÄ‚îÄ Sprint 5 : State Management (0/8 t√¢ches)
‚îú‚îÄ‚îÄ Sprint 6 : Fallbacks (0/7 t√¢ches)
‚îî‚îÄ‚îÄ Sprint 7 : Documentation (0/6 t√¢ches)

PHASE 3 : Optimisation (0/3 sprints)
‚îú‚îÄ‚îÄ Sprint 8 : Performance (0/6 t√¢ches)
‚îú‚îÄ‚îÄ Sprint 9 : Monitoring (0/4 t√¢ches)
‚îî‚îÄ‚îÄ Sprint 10 : CI/CD (0/3 t√¢ches)

TOTAL : 0/82 t√¢ches compl√©t√©es (0%)
```

---

## üéì Ressources et R√©f√©rences

### Documentation Technique

- [Better Auth Documentation](https://www.better-auth.com/docs)
- [Drizzle ORM](https://orm.drizzle.team/docs/overview)
- [Zustand](https://github.com/pmndrs/zustand)
- [Vitest](https://vitest.dev/)
- [React Testing Library](https://testing-library.com/react)

### Guides de R√©f√©rence

- [CRITIQUE_ET_PRECONISATION.md](./CRITIQUE_ET_PRECONISATION.md) - Analyse compl√®te
- [DATABASE_SCHEMA.md](./DATABASE_SCHEMA.md) - Sch√©ma de base de donn√©es
- [MIGRATION_GUIDE.md](./MIGRATION_GUIDE.md) - Guide de migration DB

---

**Derni√®re mise √† jour** : 2024  
**Version** : 1.0  
**Statut** : üìã Pr√™t √† √™tre ex√©cut√©  
**Prochaine r√©vision** : Apr√®s chaque sprint
